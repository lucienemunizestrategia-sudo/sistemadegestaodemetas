<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prospera Rio - Gestão de Metas</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --azul-principal: #092040;
  --azul-secundaria: #00B7D7;
  --amarelo-acento: #ECC203;
  --cinza-neutro: #EFF1F3;
  --azul-escuro: #021738;
  --branco: #FFFFFF;
}
body { font-family: 'Open Sans', sans-serif; background: var(--cinza-neutro); color: var(--azul-escuro); line-height: 1.6; }
h1, h2, h3, h4 { font-family: 'Montserrat', sans-serif; font-weight: 700; }
h1 { font-size: 44px; } h2 { font-size: 32px; } h3 { font-size: 28px; font-weight: 600; } h4 { font-size: 20px; }
.hdr { background: var(--azul-principal); color: var(--branco); padding: 20px 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.hdr-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.hdr h2 { font-size: 28px; font-weight: 700; }
.hdr-btns button { background: var(--amarelo-acento); color: var(--azul-escuro); padding: 12px 24px; border: none; border-radius: 6px; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 14px; cursor: pointer; margin-left: 10px; transition: all 0.3s; text-transform: uppercase; }
.hdr-btns button:hover { background: #d4ac02; transform: translateY(-2px); }
.tabs { display: flex; gap: 10px; flex-wrap: wrap; }
.tab { background: rgba(255,255,255,0.1); color: var(--branco); padding: 12px 24px; border: none; border-radius: 6px 6px 0 0; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; text-transform: uppercase; }
.tab:hover { background: rgba(255,255,255,0.2); }
.tab.active { background: var(--amarelo-acento); color: var(--azul-escuro); }
.main { padding: 40px 20px; max-width: 1400px; margin: 0 auto; }
.dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
.stat-card { background: var(--branco); padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(2, 23, 56, 0.08); border-left: 5px solid var(--azul-secundaria); transition: all 0.3s; }
.stat-card:hover { transform: translateY(-5px); box-shadow: 0 6px 16px rgba(2, 23, 56, 0.12); }
.stat-card.mare { border-left-color: #00B7D7; }
.stat-card.jacarezinho { border-left-color: #ECC203; }
.stat-card h4 { color: var(--azul-escuro); margin-bottom: 10px; font-size: 16px; }
.stat-number { font-size: 48px; font-weight: 700; color: var(--azul-principal); font-family: 'Montserrat', sans-serif; }
.stat-label { font-size: 14px; color: #6c757d; margin-top: 5px; }
input, textarea, select { width: 100%; padding: 12px 16px; margin: 8px 0; border: 2px solid var(--azul-secundaria); border-radius: 6px; font-family: 'Open Sans', sans-serif; font-size: 16px; background: var(--branco); color: var(--azul-escuro); transition: all 0.3s; }
input:focus, textarea:focus, select:focus { outline: none; border-color: var(--azul-principal); box-shadow: 0 0 0 3px rgba(0, 183, 215, 0.1); }
textarea { min-height: 100px; resize: vertical; }
label { display: block; font-weight: 600; color: var(--azul-escuro); margin-top: 16px; margin-bottom: 6px; font-size: 16px; }
button { padding: 14px 28px; margin: 8px 8px 8px 0; background: var(--azul-secundaria); color: var(--branco); border: none; cursor: pointer; border-radius: 6px; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 14px; transition: all 0.3s; text-transform: uppercase; }
button:hover { background: #0099b8; transform: translateY(-2px); }
button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
.btn-primary { background: var(--azul-secundaria); font-size: 16px; padding: 16px 32px; }
.btn-secondary { background: #6c757d; }
.btn-danger { background: #dc3545; }
.btn-success { background: #28a745; }
.box { background: var(--branco); padding: 32px; margin: 24px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(2, 23, 56, 0.08); border-left: 4px solid var(--azul-secundaria); }
.login { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--azul-principal) 0%, var(--azul-secundaria) 100%); }
.login-box { background: var(--branco); padding: 50px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); text-align: center; max-width: 500px; width: 90%; }
.logo { display: block; margin: 0 auto 20px; max-width: 280px; height: auto; }
.location-text { color: var(--amarelo-acento); font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 20px; letter-spacing: 2px; margin-bottom: 30px; }
.form-title { color: var(--azul-principal); font-size: 28px; font-weight: 700; margin-bottom: 24px; border-bottom: 4px solid var(--amarelo-acento); padding-bottom: 12px; font-family: 'Montserrat', sans-serif; }
.field-required::after { content: " *"; color: #dc3545; font-weight: 700; }
.loading { text-align: center; padding: 60px 20px; color: var(--azul-secundaria); font-weight: 600; font-size: 18px; }
.vazio { text-align: center; color: #6c757d; padding: 60px 20px; font-size: 18px; }
@media print { .hdr-btns, button { display: none !important; } }
@media (max-width: 768px) {
  .hdr-top { flex-direction: column; gap: 16px; }
  .dashboard { grid-template-columns: 1fr; }
  h1 { font-size: 32px; } h2 { font-size: 24px; } h3 { font-size: 20px; }
  .logo { max-width: 200px; }
}
</style>
</head>
<body>
<div id="app"></div>
<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_jj1iE4D4LDRt8y0jNZ65Hxp4f9v21bQMfwcO95EBJ3YwLpNTGaN63wQZx_wPsWZx5Q/exec';

var dados = {
  ok: false,
  visualizacao: 'dashboard',
  metasMare: [],
  metasJacarezinho: [],
  carregando: false
};

async function carregarTodasMetas() {
  dados.carregando = true;
  renderizar();
  try {
    const [responseMare, responseJacare] = await Promise.all([
      fetch(SCRIPT_URL + '?action=get&local=Maré'),
      fetch(SCRIPT_URL + '?action=get&local=Jacarezinho')
    ]);
    const resultMare = await responseMare.json();
    const resultJacare = await responseJacare.json();
    if (resultMare.success) dados.metasMare = resultMare.data || [];
    if (resultJacare.success) dados.metasJacarezinho = resultJacare.data || [];
    dados.carregando = false;
    renderizar();
  } catch (error) {
    console.error('Erro:', error);
    dados.carregando = false;
    alert('Erro ao carregar dados: ' + error.message);
    renderizar();
  }
}

async function salvarMeta(meta, local) {
  try {
    const params = {
      action: 'add',
      local: local,
      e: meta.e || '',
      m: meta.m || '',
      c: meta.c || '',
      st: meta.st || 'Em andamento',
      a: meta.a || '',
      d: meta.d || '',
      o: meta.o || '',
      l: meta.l || '',
      listaPresenca: meta.listaPresenca || '',
      fotos: meta.fotos || '',
      materialDivulgacao: meta.materialDivulgacao || ''
    };
    
    console.log('Enviando para:', SCRIPT_URL);
    console.log('Dados:', params);
    
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(params)
    });
    
    const result = await response.json();
    console.log('Resposta:', result);
    
    if (result.success) {
      await carregarTodasMetas();
      return true;
    } else {
      alert('Erro: ' + result.message);
      return false;
    }
  } catch (error) {
    console.error('Erro:', error);
    alert('Erro ao salvar: ' + error.message);
    return false;
  }
}

async function apagarMeta(id, local) {
  try {
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ 
        action: 'delete', 
        local: local, 
        id: id 
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      await carregarTodasMetas();
      return true;
    }
    return false;
  } catch (error) {
    alert('Erro ao apagar: ' + error.message);
    return false;
  }
}

function renderizar() {
  const app = document.getElementById('app');
  if (!dados.ok) { app.innerHTML = telaLogin(); }
  else { app.innerHTML = telaPrincipal(); }
}

function telaLogin() {
  return `
    <div class="login">
      <div class="login-box">
        <img class="logo" src="https://lh3.googleusercontent.com/d/1x5sNkC9vd7CI78y0xdkWvgoadxPEMcIf=w800" alt="Prospera Rio">
        <div class="location-text">MARÉ · JACAREZINHO</div>
        <h3 style="color: var(--azul-principal); margin: 24px 0;">Gestão de Metas e Evidências</h3>
        <input id="senha" type="password" placeholder="Digite a senha" style="margin: 24px 0;">
        <button class="btn-primary" onclick="fazerLogin()" style="width: 100%;">ENTRAR</button>
      </div>
    </div>
  `;
}

function telaPrincipal() {
  let conteudo = '';
  if (dados.visualizacao === 'dashboard') conteudo = telaDashboard();
  else if (dados.visualizacao === 'cadastro') conteudo = telaCadastro();
  return `
    <div class="hdr">
      <div class="hdr-top">
        <h2>PROSPERA RIO - GESTÃO DE METAS</h2>
        <div class="hdr-btns">
          <button onclick="sair()">SAIR</button>
        </div>
      </div>
      <div class="tabs">
        <button class="tab ${dados.visualizacao === 'dashboard' ? 'active' : ''}" onclick="mudarVisualizacao('dashboard')">Dashboard</button>
        <button class="tab ${dados.visualizacao === 'cadastro' ? 'active' : ''}" onclick="mudarVisualizacao('cadastro')">Nova Meta</button>
      </div>
    </div>
    <div class="main">${conteudo}</div>
  `;
}

function telaDashboard() {
  const totalMare = dados.metasMare.length;
  const totalJacare = dados.metasJacarezinho.length;
  const total = totalMare + totalJacare;
  return `
    <h3 style="color: var(--azul-principal); margin-bottom: 30px;">Visão Geral do Programa</h3>
    <div class="dashboard">
      <div class="stat-card"><h4>TOTAL DE METAS</h4><div class="stat-number">${total}</div><div class="stat-label">Ambos territórios</div></div>
      <div class="stat-card mare"><h4>MARÉ</h4><div class="stat-number">${totalMare}</div><div class="stat-label">Metas cadastradas</div></div>
      <div class="stat-card jacarezinho"><h4>JACAREZINHO</h4><div class="stat-number">${totalJacare}</div><div class="stat-label">Metas cadastradas</div></div>
    </div>
    ${dados.carregando ? '<div class="loading">Carregando...</div>' : ''}
  `;
}

function telaCadastro() {
  return `
    <div class="box">
      <h3 class="form-title">Cadastrar Nova Meta</h3>
      <label class="field-required">Território</label>
      <select id="territorio">
        <option value="Maré">Maré</option>
        <option value="Jacarezinho">Jacarezinho</option>
      </select>
      <label class="field-required">Etapa</label>
      <input id="etapa" placeholder="Ex: Etapa 1">
      <label class="field-required">Descrição da Meta</label>
      <textarea id="meta" placeholder="Descreva a meta..."></textarea>
      <label>Comprovação</label>
      <input id="comprovacao" placeholder="Como será comprovada?">
      <label>Status</label>
      <select id="status">
        <option>Em andamento</option>
        <option>Encerrada</option>
      </select>
      <label>Percentual (%)</label>
      <input id="alcancada" type="number" placeholder="0 a 100" min="0" max="100">
      <label>Data</label>
      <input id="data" type="date">
      <label>Observações</label>
      <textarea id="observacao" placeholder="Informações adicionais..."></textarea>
      <h4 style="margin-top:30px; color: var(--azul-principal);">EVIDÊNCIAS</h4>
      <label>Link Principal</label>
      <input id="link" placeholder="https://" type="url">
      <label>Lista de Presença</label>
      <input id="listaPresenca" placeholder="https://" type="url">
      <label>Fotos</label>
      <input id="fotos" placeholder="https://" type="url">
      <label>Material de Divulgação</label>
      <input id="materialDivulgacao" placeholder="https://" type="url">
      <div style="margin-top: 32px; padding-top: 24px; border-top: 2px solid var(--cinza-neutro);">
        <button class="btn-primary" onclick="salvarNovaMeta()" id="btnSalvar">SALVAR META</button>
        <button class="btn-secondary" onclick="mudarVisualizacao('dashboard')">CANCELAR</button>
      </div>
    </div>
  `;
}

function fazerLogin() {
  const senha = document.getElementById('senha').value;
  if (senha === 'prospera2025') {
    dados.ok = true;
    carregarTodasMetas();
  } else {
    alert('Senha incorreta');
  }
}

function sair() {
  if (confirm('Deseja sair?')) {
    dados.ok = false;
    renderizar();
  }
}

function mudarVisualizacao(tipo) {
  dados.visualizacao = tipo;
  renderizar();
}

async function salvarNovaMeta() {
  const btnSalvar = document.getElementById('btnSalvar');
  btnSalvar.disabled = true;
  btnSalvar.textContent = 'SALVANDO...';
  
  const meta = {
    e: document.getElementById('etapa').value.trim(),
    m: document.getElementById('meta').value.trim(),
    c: document.getElementById('comprovacao').value.trim(),
    st: document.getElementById('status').value,
    a: document.getElementById('alcancada').value,
    d: document.getElementById('data').value,
    o: document.getElementById('observacao').value.trim(),
    l: document.getElementById('link').value.trim(),
    listaPresenca: document.getElementById('listaPresenca').value.trim(),
    fotos: document.getElementById('fotos').value.trim(),
    materialDivulgacao: document.getElementById('materialDivulgacao').value.trim()
  };
  
  const territorio = document.getElementById('territorio').value;
  
  if (!meta.e || !meta.m) {
    alert('Preencha: Etapa e Descrição');
    btnSalvar.disabled = false;
    btnSalvar.textContent = 'SALVAR META';
    return;
  }
  
  const sucesso = await salvarMeta(meta, territorio);
  
  if (sucesso) {
    alert('Meta cadastrada!');
    dados.visualizacao = 'dashboard';
    renderizar();
  } else {
    btnSalvar.disabled = false;
    btnSalvar.textContent = 'SALVAR META';
  }
}

renderizar();
</script>
</body>
</html>
